{"id":"6FTF","dependencies":[{"name":"/Users/chriswf/Documents/Projects/unch-gadget/node_modules/one-gadget-loader/tsconfig.json","includedInParent":true,"mtime":1569550736035},{"name":"/Users/chriswf/Documents/Projects/unch-gadget/packages/unch-app-gadget/package.json","includedInParent":true,"mtime":1569550537782},{"name":"/Users/chriswf/Documents/Projects/unch-gadget/node_modules/one-gadget-loader/package.json","includedInParent":true,"mtime":1569550736034}],"generated":{"js":"\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar _this = this;\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.loader = function (options, init) {\n    if (options === void 0) { options = {}; }\n    return new Promise(function (resolve, reject) {\n        var HubSettings = gadgets.HubSettings;\n        HubSettings.onConnect = function () { return __awaiter(_this, void 0, void 0, function () {\n            var base, img, src, index, resolver, url, resolved, _a, params;\n            return __generator(this, function (_b) {\n                img = document.getElementById('L_5CC6352F51BC44D8BE60C902B79C442C');\n                if (img) {\n                    src = img.src;\n                    index = src.lastIndexOf('__loc.png');\n                    if (index !== -1) {\n                        base = src.substr(0, index);\n                    }\n                }\n                resolver = (base) ?\n                    (function (url) { return (\"\" + base + url); }) :\n                    (function (url) { return (url); });\n                url = options.url;\n                resolved = resolver(url);\n                _a = options.params, params = _a === void 0 ? {\n                    cache: 'no-cache',\n                    headers: {\n                        \"Content-Type\": \"application/json\",\n                    },\n                } : _a;\n                fetch(resolved, params).then(function (resp) {\n                    if (!(resp.ok)) {\n                        var status = resp.status;\n                        reject({\n                            message: 'Error fetching settings',\n                            description: \"status: \" + status + \" url: \" + resolved\n                        });\n                    }\n                    else {\n                        resp.json().then(function (settings) {\n                            var Config = finesse.gadget.Config, User = finesse.restservices.User, ClientLogger = finesse.cslogger.ClientLogger, ClientServices = finesse.clientservices.ClientServices;\n                            // initialize the client servvices\n                            ClientServices.init(Config);\n                            // initailize the logger\n                            var Hub = gadgets.Hub;\n                            ClientLogger.init(Hub, Config.id, Config);\n                            new User({\n                                id: Config.id,\n                                onLoad: function (user) {\n                                    init({\n                                        user: user,\n                                        resolver: resolver,\n                                        settings: settings,\n                                    });\n                                },\n                            });\n                            var ContainerServices = finesse.containerservices.ContainerServices;\n                            // initiailize the container\n                            // and adjust the gadget height\n                            var services = ContainerServices.init();\n                            services.addHandler(ContainerServices.Topics.ACTIVE_TAB, function () {\n                                var gadWin = gadgets.window;\n                                // activate the current tab\n                                if ((gadWin) && (gadWin.adjustHeight)) {\n                                    gadWin.adjustHeight();\n                                }\n                            });\n                            services.makeActiveTabReq();\n                            resolve({\n                                settings: settings,\n                                services: services,\n                            });\n                        }).catch(function (exp) {\n                            reject({\n                                message: 'Error fetching settings, invalid content',\n                                description: exp.message,\n                            });\n                        });\n                    }\n                }).catch(function (exp) {\n                    reject({\n                        message: 'Error fetching settings, server unreachable',\n                        description: \"server unreachable, url: \" + resolved\n                    });\n                });\n                return [2 /*return*/];\n            });\n        }); };\n    });\n};\n"},"sourceMaps":{"js":{"version":3,"file":"loader.js","sourceRoot":"","sources":["../../../node_modules/one-gadget-loader/src/loader.ts"],"names":[],"mappings":"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","sourcesContent":["declare const gadgets: any;\ndeclare const finesse: any;\n\nimport { Resolver } from 'one-core';\n\nexport const loader = (\n    options: any = {},\n    init: (opts: any) => void,\n) => {\n    return new Promise((resolve, reject) => {\n        const { HubSettings } = gadgets;\n        HubSettings.onConnect = async () => {\n            let base: string;\n            // Finesse container re-writes the urls included \n            // in main gadget mark up (html) \n            const img = document.getElementById(\n                'L_5CC6352F51BC44D8BE60C902B79C442C',\n            ) as HTMLImageElement;\n\n            if (img) {\n                var src = img.src;\n                const index = src.lastIndexOf('__loc.png');\n                if (index !== -1) {\n                    base = src.substr(0, index);\n                }\n            }\n\n            const resolver: Resolver = (base) ?\n                ((url: string) => (`${base}${url}`)) :\n                ((url: string) => (url));\n\n            const { url } = options;\n            const resolved = resolver(url);\n\n            const {\n                params = {\n                    cache: 'no-cache',\n                    headers: {\n                        \"Content-Type\": \"application/json\",\n                    },\n                },\n            } = options;\n\n            fetch(resolved, params).then((resp: any) => {\n                if (!(resp.ok)) {\n                    const { status } = resp;\n                    reject({\n                        message: 'Error fetching settings',\n                        description: `status: ${status} url: ${resolved}`\n                    });\n                } else {\n                    resp.json().then((settings: any) => {\n                        \n                        const {\n                            gadget: { Config },\n                            restservices: { User },\n                            cslogger: { ClientLogger },\n                            clientservices: { ClientServices },\n                        } = finesse;\n\n                        // initialize the client servvices\n                        ClientServices.init(Config);\n\n                        // initailize the logger\n                        const { Hub } = gadgets;\n                        ClientLogger.init(Hub, Config.id, Config);\n\n                        new User({\n                            id: Config.id,\n                            onLoad: (user: any) => {\n                                init({\n                                    user,\n                                    resolver,\n                                    settings,\n                                });\n                            },\n                        });\n\n                        const {\n                            containerservices: {\n                                ContainerServices\n                            },\n                        } = finesse;\n\n                        // initiailize the container\n                        // and adjust the gadget height\n                        const services = ContainerServices.init();\n                        services.addHandler(ContainerServices.Topics.ACTIVE_TAB, () => {\n                            const { window: gadWin } = gadgets;\n                            // activate the current tab\n                            if ((gadWin) && (gadWin.adjustHeight)) {\n                                gadWin.adjustHeight();\n                            }\n                        });\n\n                        services.makeActiveTabReq();\n                        resolve({\n                            settings,\n                            services,\n                        });\n                    }).catch((exp: any) => {\n                        reject({\n                            message: 'Error fetching settings, invalid content',\n                            description: exp.message,\n                        });\n                    });\n                }\n            }).catch((exp: any) => {\n                reject({\n                    message: 'Error fetching settings, server unreachable',\n                    description: `server unreachable, url: ${resolved}`\n                });\n            });\n        };\n    });\n}\n\n"]}},"error":null,"hash":"d87b3b23a2aa322af5ab238f2a0a8887","cacheData":{"env":{}}}